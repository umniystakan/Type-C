<!DOCTYPE html>
<html lang="ru">

<head>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="description" content="Type-C - –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –Ω–∞ –±–∞–∑–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ Matrix">
    <meta name="keywords" content="messenger, matrix, chat, encryption, secure messaging">
    <title>Type-C Messenger</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@300;400;600;800;900&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">

    <!-- Matrix E2EE (Olm) -->
    <script src="https://cdn.jsdelivr.net/npm/@matrix-org/olm/olm.js"></script>

    <!-- Matrix SDK -->
    <script src="https://cdn.jsdelivr.net/npm/matrix-js-sdk/dist/browser-matrix.min.js"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css?v=215">

    <!-- Early Theme Loader -->
    <script>
        (function () {
            const savedTheme = localStorage.getItem('matrix_theme') || 'green';
            document.documentElement.setAttribute('data-theme', savedTheme);
            // Apply to body as soon as it's available
            document.addEventListener('DOMContentLoaded', () => {
                document.body.setAttribute('data-theme', savedTheme);
            });
        })();
    </script>
</head>

<body>
    <!-- Global Visual Effects Overlay -->
    <div class="global-visual-effects">
        <canvas id="matrix-rain"></canvas>
        <div class="cyber-grid"></div>
        <div class="scanlines"></div>
        <div class="glass-blobs">
            <div class="blob blob-1"></div>
            <div class="blob blob-2"></div>
            <div class="blob blob-3"></div>
        </div>
        <!-- Cyber-Organic Holographic Gradient -->
        <svg width="0" height="0" style="position:absolute;">
            <defs>
                <linearGradient id="holographic-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:var(--color-accent-green)" />
                    <stop offset="50%" style="stop-color:var(--color-accent-blue)" />
                    <stop offset="100%" style="stop-color:var(--color-accent-pink)" />
                </linearGradient>
            </defs>
        </svg>

        <!-- Liquid Gooey Filter -->
        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" style="display:none;">
            <defs>
                <filter id="goo">
                    <feGaussianBlur in="SourceGraphic" stdDeviation="40" result="blur" />
                    <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 60 -25"
                        result="goo" />
                    <feComposite in="SourceGraphic" in2="goo" operator="atop" />
                </filter>
            </defs>
        </svg>
    </div>

    <!-- Room Members Modal -->
    <div id="members-modal" class="modal">
        <div class="modal-content members-modal-content">
            <div class="modal-header">
                <h3>–£—á–∞—Å—Ç–Ω–∏–∫–∏ –∫–æ–º–Ω–∞—Ç—ã</h3>
                <button class="modal-close" id="close-members-modal" data-modal="members-modal">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="members-search">
                    <input type="text" id="member-search-input" placeholder="–ü–æ–∏—Å–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤...">
                </div>
                <div id="members-list-container" class="members-list">
                    <!-- Members will be loaded here -->
                </div>
            </div>
        </div>
        <div class="modal-overlay" data-modal="members-modal"></div>
    </div>

    <!-- Notifications Container -->
    <div id="notification-container" class="notification-container"></div>

    <!-- Login Screen -->
    <div id="login-screen" class="screen active">
        <div class="login-container">
            <div class="logo-section">
                <div class="logo">
                    <svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M30 5L55 17.5V42.5L30 55L5 42.5V17.5L30 5Z" stroke="url(#logo-gradient)"
                            stroke-width="3" fill="none" />
                        <circle cx="30" cy="30" r="8" fill="url(#logo-gradient)" />
                        <defs>
                            <linearGradient id="logo-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" class="stop-1" />
                                <stop offset="100%" class="stop-2" />
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                <h1>Type-C</h1>
                <p class="tagline">–ó–∞—â–∏—â—ë–Ω–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –Ω–∞ Matrix</p>
            </div>

            <div class="auth-tabs">
                <button type="button" class="auth-tab active" data-tab="login">–í—Ö–æ–¥</button>
                <button type="button" class="auth-tab" data-tab="register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </div>

            <form id="auth-form" class="login-form">
                <!-- Homeserver is hardcoded to https://type-c-kmr.duckdns.org/ -->

                <div class="form-group">
                    <label for="username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <input type="text" id="username" placeholder="@user:type-c-kmr.duckdns.org" required
                        autocomplete="username">
                </div>

                <div class="form-group">
                    <label for="password">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required
                        autocomplete="current-password">
                </div>

                <div class="form-group hidden" id="confirm-password-group">
                    <label for="confirm-password">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                    <input type="password" id="confirm-password" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
                        autocomplete="new-password">
                </div>

                <div class="form-group hidden" id="email-group">
                    <label for="email">Email (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <input type="email" id="email" placeholder="email@example.com" autocomplete="email">
                </div>

                <button type="submit" class="btn-primary" id="auth-btn">
                    <span>–í–æ–π—Ç–∏</span>
                </button>

                <div id="auth-error" class="error-message"></div>

                <div class="server-info">
                    <p>–°–µ—Ä–≤–µ—Ä: <span class="server-badge">type-c-kmr.duckdns.org</span></p>
                </div>
            </form>

        </div>
    </div>

    <!-- Main Chat Screen -->
    <div id="chat-screen" class="screen">
        <div class="chat-container">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-header-wrapper">
                    <div id="connection-status" class="connection-status connecting">
                        <span class="status-dot"></span>
                        <span class="status-text">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</span>
                    </div>
                    <div class="sidebar-header">
                        <div class="user-profile">
                            <div class="avatar" id="user-avatar">
                                <div class="status-indicator online"></div>
                            </div>
                            <div class="user-info">
                                <h3 id="user-display-name">Loading...</h3>
                                <p id="user-id">@user:matrix.org</p>
                            </div>
                        </div>
                        <div class="sidebar-actions">
                            <button class="btn-icon" id="profile-settings-btn" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                            </button>
                            <button class="btn-icon" id="logout-btn" title="–í—ã–π—Ç–∏">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                                    <polyline points="16 17 21 12 16 7" />
                                    <line x1="21" y1="12" x2="9" y2="12" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div> <!-- closing sidebar-header-wrapper -->

                <!-- Tabs -->
                <div class="tabs">
                    <button class="tab-btn active" data-tab="dms" id="tab-dms">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                        </svg>
                        <span>–õ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è</span>
                    </button>
                    <button class="tab-btn" data-tab="rooms" id="tab-rooms">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <rect x="3" y="3" width="7" height="7" />
                            <rect x="14" y="3" width="7" height="7" />
                            <rect x="14" y="14" width="7" height="7" />
                            <rect x="3" y="14" width="7" height="7" />
                        </svg>
                        <span>–ö–æ–º–Ω–∞—Ç—ã</span>
                    </button>
                    <button class="tab-btn" data-tab="invites" id="tab-invites">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="8.5" cy="7" r="4"></circle>
                            <line x1="20" y1="8" x2="20" y2="14"></line>
                            <line x1="23" y1="11" x2="17" y2="11"></line>
                        </svg>
                        <span>–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è</span>
                    </button>
                </div>

                <!-- Action Buttons Header -->
                <div class="sidebar-section-header" id="toggle-actions-btn">
                    <span>–î–µ–π—Å—Ç–≤–∏—è</span>
                    <svg class="chevron-icon" width="14" height="14" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons" id="action-buttons-container">
                    <button class="btn-action" id="new-dm-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19" />
                            <line x1="5" y1="12" x2="19" y2="12" />
                        </svg>
                        <span>–ù–æ–≤–æ–µ –õ–°</span>
                    </button>
                    <button class="btn-action" id="new-encrypted-dm-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                        </svg>
                        <span>–ó–∞—â–∏—â–µ–Ω–Ω–æ–µ –õ–° üîí</span>
                    </button>
                    <button class="btn-action" id="create-room-btn" style="display:none;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19" />
                            <line x1="5" y1="12" x2="19" y2="12" />
                        </svg>
                        <span>–°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</span>
                    </button>
                    <button class="btn-action" id="sidebar-summary-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                        <span>–°–≤–æ–¥–∫–∞</span>
                    </button>
                    <button class="btn-action" id="sidebar-settings-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path
                                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                            </path>
                        </svg>
                        <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</span>
                    </button>
                </div>

                <div class="rooms-list" id="rooms-list">
                    <div class="loading-rooms">
                        <div class="spinner"></div>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                    </div>
                </div>

                <div class="rooms-list hidden" id="invites-list">
                    <!-- Invites will be loaded here -->
                    <div class="empty-state">–ù–µ—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π</div>
                </div>
            </aside>

            <!-- Main Chat Area -->
            <main class="chat-main">
                <div class="chat-header" id="chat-header">
                    <div class="room-info">
                        <button id="back-to-rooms-btn" class="btn-icon mobile-only"
                            style="display: none; margin-right: 10px;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M19 12H5M12 19l-7-7 7-7" />
                            </svg>
                        </button>
                        <div class="room-title-wrapper">
                            <h2 id="current-room-name">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–Ω–∞—Ç—É</h2>
                            <p id="room-members-count">0 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</p>
                        </div>
                    </div>
                    <div class="room-actions">
                        <button id="header-summary-btn" class="btn-icon mobile-only-inline" title="–°–≤–æ–¥–∫–∞">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10 9 9 9 8 9"></polyline>
                            </svg>
                        </button>
                        <button id="room-settings-btn" class="btn-icon" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏" style="display: none;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="3"></circle>
                                <path
                                    d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                                </path>
                            </svg>
                        </button>

                        <div id="room-settings-menu" class="settings-dropdown hidden">
                            <button id="invite-user-btn" class="dropdown-item">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞</button>
                            <button id="view-members-btn" class="dropdown-item">–£—á–∞—Å—Ç–Ω–∏–∫–∏</button>
                            <button id="leave-room-btn" class="dropdown-item text-danger">–í—ã–π—Ç–∏ (–ü–æ–∫–∏–Ω—É—Ç—å)</button>
                        </div>
                    </div>
                </div>

                <div class="messages-container" id="messages-container">
                    <div class="welcome-message">
                        <svg width="80" height="80" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M30 5L55 17.5V42.5L30 55L5 42.5V17.5L30 5Z" stroke="url(#logo-gradient)"
                                stroke-width="2" fill="none" />
                            <circle cx="30" cy="30" r="8" fill="url(#logo-gradient)" />
                            <defs>
                                <linearGradient id="logo-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" class="stop-1" />
                                    <stop offset="100%" class="stop-2" />
                                </linearGradient>
                            </defs>
                        </svg>
                        <h3>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Type-C</h3>
                        <p>–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–Ω–∞—Ç—É —Å–ª–µ–≤–∞, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ</p>
                    </div>
                </div>

                <div class="message-input-container" id="message-input-container">
                    <form id="message-form" class="message-form">
                        <div class="message-input-wrapper">
                            <input type="file" id="file-input" hidden>
                            <button type="button" class="btn-icon" id="attach-btn" disabled title="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path
                                        d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48">
                                    </path>
                                </svg>
                            </button>
                            <input type="text" id="message-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." disabled>
                            <button type="submit" class="btn-send" id="send-btn" disabled>
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <line x1="22" y1="2" x2="11" y2="13" />
                                    <polygon points="22 2 15 22 11 13 2 9 22 2" />
                                </svg>
                            </button>
                        </div>
                    </form>
                </div>
            </main>
        </div>

        <!-- Modals -->
        <!-- New DM Modal -->
        <div class="modal" id="new-dm-modal">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h3>–ù–æ–≤–æ–µ –ª–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</h3>
                    <button class="modal-close" data-modal="new-dm-modal">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18" />
                            <line x1="6" y1="6" x2="18" y2="18" />
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="user-search-input">–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <input type="text" id="user-search-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏–ª–∏ @user:server.org">
                    </div>
                    <div class="search-results" id="user-search-results">
                        <p class="search-hint">–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Create Room Modal -->
        <div class="modal" id="create-room-modal">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h3>–°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</h3>
                    <button class="modal-close" data-modal="create-room-modal">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18" />
                            <line x1="6" y1="6" x2="18" y2="18" />
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="create-room-form">
                        <div class="form-group">
                            <label for="room-name">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã *</label>
                            <input type="text" id="room-name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –û–±—â–∏–π —á–∞—Ç" required>
                        </div>
                        <div class="form-group">
                            <label for="room-topic">–¢–µ–º–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                            <input type="text" id="room-topic" placeholder="–û —á–µ–º —ç—Ç–∞ –∫–æ–º–Ω–∞—Ç–∞?">
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="room-public">
                                <span>–ü—É–±–ª–∏—á–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞ (–¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞)</span>
                            </label>
                        </div>
                        <button type="submit" class="btn-primary">–°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</button>
                    </form>
                </div>
            </div>
        </div>


    </div>

    <!-- App Script -->
    <!-- Profile Modal (User info only) -->
    <!-- Profile Modal (User info only) -->
    <div id="profile-modal" class="modal">
        <div class="modal-content profile-settings">
            <div class="modal-header">
                <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</h2>
                <button class="btn-close" id="close-profile-modal">&times;</button>
            </div>
            <div class="profile-avatar-setup">
                <div class="avatar-large" id="profile-avatar-preview">
                    <!-- Avatar image or initials -->
                </div>
                <input type="file" id="avatar-upload" hidden accept="image/*">
                <button class="btn-secondary btn-sm" onclick="document.getElementById('avatar-upload').click()">
                    –ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ
                </button>
            </div>
            <div class="form-group">
                <label for="profile-display-name">–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è</label>
                <input type="text" id="profile-display-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
            </div>
            <div class="modal-footer">
                <button class="btn-primary" id="save-profile-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
        <div class="modal-overlay" data-modal="profile-modal"></div>
    </div>

    <!-- App Settings Modal (Themes, Rain, etc.) -->
    <div id="app-settings-modal" class="modal">
        <div class="modal-content app-settings">
            <div class="modal-header">
                <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h2>
                <button class="modal-close" data-modal="app-settings-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>–í–Ω–µ—à–Ω–∏–π –≤–∏–¥</label>
                    <div class="setting-item">
                        <span>–¶–∏—Ñ—Ä–æ–≤–æ–π –¥–æ–∂–¥—å</span>
                        <button id="matrix-rain-btn" class="btn-toggle active">–í–ö–õ</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</label>
                    <div class="theme-picker">
                        <div class="theme-swatch theme-green active" data-theme="green" title="–ó–µ–ª–µ–Ω—ã–π"></div>
                        <div class="theme-swatch theme-blue" data-theme="blue" title="–ì–æ–ª—É–±–æ–π"></div>
                        <div class="theme-swatch theme-yellow" data-theme="yellow" title="–ñ–µ–ª—Ç—ã–π"></div>
                        <div class="theme-swatch theme-red" data-theme="red" title="–ö—Ä–∞—Å–Ω—ã–π"></div>
                        <div class="theme-swatch theme-white" data-theme="white" title="–ë–µ–ª—ã–π"></div>
                        <div class="theme-swatch theme-pink" data-theme="pink" title="–†–æ–∑–æ–≤—ã–π"></div>
                        <div class="theme-swatch theme-purple" data-theme="purple" title="–§–∏–æ–ª–µ—Ç–æ–≤—ã–π"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-overlay" data-modal="app-settings-modal"></div>
    </div>

    <!-- Summary Modal -->
    <div class="modal" id="summary-modal">
        <div class="modal-content summary-content">
            <div class="modal-header">
                <h3>–°–≤–æ–¥–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h3>
                <div class="header-widgets">
                </div>
                <button class="modal-close" data-modal="summary-modal">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="modal-body summary-grid">
                <section class="summary-section time-section full-width">
                    <div class="clock-widget">
                        <div id="summary-time" class="time-main">00:00:00</div>
                        <div id="summary-date" class="date-sub">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 2 —Ñ–µ–≤—Ä–∞–ª—è 2026</div>
                    </div>
                </section>
                <section class="summary-section unread-section">
                    <h4>–ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ</h4>
                    <div id="summary-unread-list" class="summary-list">
                        <p class="empty-text">–ù–µ—Ç –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π</p>
                    </div>
                </section>

                <section class="summary-section recent-section">
                    <h4>–ù–µ–¥–∞–≤–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h4>
                    <div id="summary-recent-list" class="summary-list">
                        <p class="empty-text">–ù–µ—Ç –Ω–µ–¥–∞–≤–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</p>
                    </div>
                </section>

                <section class="summary-section calendar-section">
                    <div class="calendar-header">
                        <button class="calendar-nav-btn" onclick="window.messenger.changeMonth(-1)">&lt;</button>
                        <h4 id="calendar-month-year">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</h4>
                        <button class="calendar-nav-btn" onclick="window.messenger.changeMonth(1)">&gt;</button>
                    </div>
                    <div id="calendar-widget" class="calendar-container">
                        <!-- Calendar grid will be generated here -->
                    </div>
                </section>

                <section class="summary-section quote-section full-width">
                    <div class="quote-container">
                        <div class="quote-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M14.017 21L14.017 18C14.017 16.8954 14.9124 16 16.017 16H19.017C19.5693 16 20.017 15.5523 20.017 15V9C20.017 8.44772 19.5693 8 19.017 8H16.017C15.4647 8 15.017 8.44772 15.017 9V12C15.017 12.5523 14.5693 13 14.017 13H11.017V21H14.017ZM5.017 21L5.017 18C5.017 16.8954 5.91243 16 7.017 16H10.017C10.5693 16 11.017 15.5523 11.017 15V9C11.017 8.44772 10.5693 8 10.017 8H7.017C6.46472 8 6.017 8.44772 6.017 9V12C6.017 12.5523 5.56929 13 5.017 13H2.017V21H5.017Z" />
                            </svg>
                        </div>
                        <p id="summary-quote-text" class="quote-text">–ó–∞–≥—Ä—É–∑–∫–∞ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è...</p>
                        <span id="summary-quote-author" class="quote-author"></span>
                    </div>
                </section>
            </div>
        </div>
        <div class="modal-overlay" data-modal="summary-modal"></div>
    </div>

    <!-- Invite User Modal -->
    <div class="modal" id="invite-user-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞</h3>
                <button class="modal-close" data-modal="invite-user-modal">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="invite-user-form">
                    <div class="form-group">
                        <label for="invite-username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <input type="text" id="invite-username" placeholder="@user:server" required>
                        <p class="form-hint">–ù–∞–ø—Ä–∏–º–µ—Ä: @ivan:type-c-kmr.duckdns.org</p>
                    </div>
                    <button type="submit" class="btn-primary">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å</button>
                </form>
            </div>
        </div>
        <div class="modal-overlay" data-modal="invite-user-modal"></div>
    </div>


    <script src="app.js?v=215"></script>

    <!-- Matrix Rain Visual Effect Logic -->
    <script>
        // Matrix Rain - DISABLED on mobile, enabled on PC only
        document.addEventListener('DOMContentLoaded', function () {
            const isMobile = window.innerWidth < 768;
            const canvas = document.getElementById('matrix-rain');

            if (isMobile) {
                console.log('[MATRIX] Mobile detected - DISABLED');
                if (canvas) canvas.style.display = 'none';
                return;
            }

            console.log('[MATRIX] PC detected - enabling');
            localStorage.setItem('matrix_rain_enabled', 'true');
            if (canvas) {
                canvas.style.display = 'block';
                canvas.style.opacity = '0.4';
            }
        });

        (function () {
            // SKIP ENTIRELY ON MOBILE
            if (window.innerWidth < 768) {
                console.log('[MATRIX] Mobile - script skipped');
                return;
            }

            console.log('[MATRIX] Script starting (PC only)...');
            const canvas = document.getElementById('matrix-rain');
            if (!canvas) {
                console.error("Matrix canvas not found!");
                return;
            }
            const ctx = canvas.getContext('2d');

            let width, height, columns;
            let drops = [];

            // Matrix Characters
            const chars = '01ÔΩ±ÔΩ≤ÔΩ≥ÔΩ¥ÔΩµÔΩ∂ÔΩ∑ÔΩ∏ÔΩπÔΩ∫ÔΩªÔΩºÔΩΩÔΩæÔΩøÔæÄÔæÅÔæÇÔæÉÔæÑÔæÖÔæÜÔæáÔæàÔæâÔæäÔæãÔæåÔæçÔæéÔæèÔæêÔæëÔæíÔæìÔæîÔæïÔæñÔæóÔæòÔæôÔæöÔæõÔæúÔæù';

            function resize() {
                const isMobile = window.innerWidth < 768;
                // Aggressive optimization: Render at 0.5x resolution on mobile
                const textScale = isMobile ? 0.5 : 1;

                // Force Canvas Size & Position - FIXED
                Object.assign(canvas.style, {
                    width: '100vw',
                    height: '100vh',
                    position: 'fixed',
                    top: '0',
                    left: '0',
                    zIndex: isMobile ? '1' : '0',
                    opacity: isMobile ? '0.6' : '0.4',
                    pointerEvents: 'none',
                    display: 'block'
                });

                // Set internal resolution
                width = canvas.width = window.innerWidth * textScale;
                height = canvas.height = window.innerHeight * textScale;

                // Force CSS to stretch it back to full screen
                canvas.style.width = '100vw';
                canvas.style.height = '100vh';
                canvas.style.position = 'fixed';
                canvas.style.top = '0';
                canvas.style.left = '0';

                // On mobile (0.5x), 10px internal = 20px visual
                const fontSize = isMobile ? 12 : 14;

                columns = Math.floor(width / fontSize);
                // Reset drops if columns changed drastically
                if (drops.length !== columns) {
                    drops = Array(columns).fill(1).map(() => Math.random() * -50);
                }

                ctx.font = '700 ' + fontSize + 'px "JetBrains Mono", monospace';
            }

            function getThemeColor() {
                // FORCE BRIGHT GREEN ON MOBILE FOR VISIBILITY
                if (window.innerWidth < 768) return '#00ff00';

                const style = getComputedStyle(document.documentElement);
                return style.getPropertyValue('--color-accent-green').trim() || '#00ffaa';
            }

            // FPS Control
            let lastTime = 0;

            function draw(currentTime) {
                requestAnimationFrame(draw);

                const isMobile = window.innerWidth < 768;
                const fps = isMobile ? 20 : 30; // 20 FPS on mobile
                const interval = 1000 / fps;

                if (currentTime - lastTime < interval) return;
                lastTime = currentTime - (currentTime % interval);

                // Heavy trail fade for mobile to avoid overdraw (0.2 vs 0.05)
                ctx.fillStyle = isMobile ? 'rgba(0, 0, 0, 0.15)' : 'rgba(0, 0, 0, 0.05)';
                ctx.fillRect(0, 0, width, height);

                const color = getThemeColor();
                // Re-set font
                const fontSize = isMobile ? 12 : 14;
                ctx.font = '700 ' + fontSize + 'px "JetBrains Mono", monospace';

                for (let i = 0; i < drops.length; i++) {
                    // Mobile: skip 40% of columns randomly per frame
                    if (isMobile && Math.random() > 0.6) continue;

                    const text = chars[Math.floor(Math.random() * chars.length)];
                    const x = i * fontSize;
                    const y = drops[i] * fontSize;

                    // Leading character
                    ctx.fillStyle = '#fff';
                    ctx.fillText(text, x, y);

                    // Trail character
                    if (!isMobile || Math.random() > 0.5) {
                        ctx.fillStyle = color;
                        ctx.fillText(text, x, y - fontSize);
                    }

                    // Reset
                    if (y > height && Math.random() > 0.975) {
                        drops[i] = 0;
                    }
                    drops[i]++;
                }
            }

            window.addEventListener('resize', resize);
            resize();
            requestAnimationFrame(draw);
        })();
    </script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(() => console.log('SW —Ä–∞–±–æ—Ç–∞–µ—Ç'))
                .catch(err => console.log('SW –æ—à–∏–±–∫–∞', err));
        }
    </script>

</body>

</html>